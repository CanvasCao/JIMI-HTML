<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no"/>
    <title>产品详情</title>
    <style type="text/css">
        * {
            padding: 0;
            margin: 0;
            text-decoration: none;
            list-style: none;
            font: 14px '微软雅黑';
            /**/
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            -webkit-highlight: none;
            -webkit-text-size-adjust: none;

            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        input, button, select, textarea {
            outline: 0 none;
            border: 0px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;

            -webkit-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        body {
            box-sizing: border-box;
            margin-bottom: 150px;
            margin-top: 55px;
        }

        .download {
            position: fixed;
            top: 0;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 2px 0px 6px rgba(0, 0, 0, 0.4);
            display: inline-block;
            background-color: white;
            z-index: 9999;
        }

        .culletContainer {
            position: relative;
            height: 200px;
            border-bottom: 20px solid #f4f4f4;
            overflow: hidden;
        }

        #cullet {
            /*background-color: rgba(0, 0, 0, 0.25);*/

            position: absolute;
            width: 200%;
            height: 200px;
            top: 0;
            left: 0;
            z-index: 2000;
            display: none;
        }

        .textDes {
            border-bottom: 20px solid #f4f4f4;
            box-sizing: border-box;
            padding: 15px 15px
        }

        .navBar {
            box-sizing: border-box;
            padding: 10px 15px;
            border-bottom: 1px solid #f4f4f4;
            border-top: 5px solid #f4f4f4;

        }

        #params {
            box-sizing: border-box;
            padding: 10px 15px;
        }

        #productDetailCanvas {
            box-sizing: border-box;
            padding: 0px 15px;

        }

    </style>
</head>
<body>
<div class="download"></div>
<div class="culletContainer">
    <img src="" alt=""/>

    <div id='cullet'></div>
</div>

<div class="textDes">
    <div class='chiName'></div>
    <div class='engName'></div>
    <div class='volAndPrice'></div>
</div>

<div class='navBar' id='navBar1'></div>

<div id='honeyComb'></div>

<div class='navBar' id='navBar2'></div>

<div id='params'></div>

<div class='navBar' id='navBar3'></div>

<div id="productDetailCanvas"></div>


<script src='js/jquery-1.8.2.min.js'></script>
<script src='js/underscore/underscore.js'></script>
<script src='js/download/download.js'></script>
<script src='js/cullet/cullet-4.0.0.js'></script>
<script src='js/navBar-2.0.0.js'></script>
<script src='js/productParams-1.0.0.js'></script>
<script src='js/echartsBasic&Graph.min.js'></script>
<script src='js/productDetailCanvas-1.0.2.js'></script>
<script src='js/Honeycomb-1.0.0.js'></script>
<script src='js/jimiHost.js'></script>

<script>
    if (!window.location.search) {
        window.location = window.location + '?pid=56829f09efb80c4e26c43eea';
    }
    // 调理剂有问题 5682a03defb80c4e26c48c39
    // 56c6aea3efb80c9b2541ced4 有数据的
    // 56829a0fefb80c4e26c2f894 没数据的


    String.prototype.searchToJson = function () {
        var search = window.location.search.replace('?', "");
        var kvArr = search.split('&');
        var finalJson = {}
        for (i = 0; i < kvArr.length; i++) {
            var kvSplit = kvArr[i].split('=');
            finalJson[kvSplit[0].toLowerCase()] = kvSplit[1];
        }
        return finalJson;
    }
    window.searchJson = searchJson = window.location.search.searchToJson();


    //download对象
    var download = new Download('.download', null);


    //ajax绑定数据
    $.ajax({
        type: "get",
        url: jimiHost + '/formual_safe.php' + window.location.search,
//            url: 'package.json',
        dataType: "jsonp",
        jsonp: "callback",
        jsonpCallback: "jsonpcallback",
        success: function (data) {
            console.log(JSON.stringify(data));

            //绑定图片
            var culletContainerH = $('.culletContainer').height();
            $('.culletContainer img').css({
                display: 'block',
                margin: '0 auto',
            }).attr('src', data.imgUrl || 'img/nodata.png').attr('height', culletContainerH);


            //绑定文字
            $('.chiName').css({
                'font-size': '16px',
            }).html(data.chineseName);
            $('.engName').css({
                'font-size': '16px',
            }).html(data.englishName);

            var volume = data.volume ? data.volume + "  " : '';
            var price = data.price ? '￥' + data.price : '';
            $('.volAndPrice').css({
                'margin-top': 10,
                'color': '#999',
            }).html(volume + price);


            //绑定导航栏
            var navBar = new NavBar('#navBar1', {
                navImg: "img/a.png",
                navTxt: '产品特征',
            });
            var navBar = new NavBar('#navBar2', {
                navImg: "img/b.png",
                navTxt: '产品参数',
            });
            var navBar = new NavBar('#navBar3', {
                navImg: "img/c.png",
                navTxt: '成分分布（' + data.component.length + '种）',
            });


            //参数数据
            var productParams = new ProductParams('#params', data);

            //中间蜂巢的数据
            var hc = new Honeycomb('#honeyComb', data);

            //中间canvas的数据
            var pdc = new ProductDetailCanvas('#productDetailCanvas', data, false);


            //没成分 canvas点击不允许跳转
            if (data.component) {
                $('#navBar3').click(function () {
                            window.location.href = 'http://n1.jimi.la/apps_T1/CompositionDistribution/CompositionDistribution.html' + window.location.search
                        }
                )
                $('#navBar3').append(' <img src="img/arrow.png" height="12px"  style="float: right;margin-top: 3px"/>')
            }


            //cullet接口
            //弹幕............................................................
            var ccm = new CommentCellManage('#cullet',
                    {
                        serverUrl: jimiHost + '/culletSelect.php',
                        closeable: false,
                        pnameable: false,
                        topBlank: 0,
                        bottomBlank: 0
                    }
            );
//        var jimiInputBox = new JimiInputBox('.jimiInputBox',
//                {ccm: ccm});

            //加载弹幕
            var pid = searchJson.pid;
            ccm.load(pid);
        },
        error: function (err) {
            console.log('ERROR!');
            console.log(err);
        }
    })
</script>
</body>
</html>